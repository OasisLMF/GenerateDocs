

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>oasislmf.model_preparation.oed &mdash; Oasis LMF 1.0.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> Oasis LMF
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/piwind_model.html">PiWind - toy model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/running_a_model_using_the_MDK.html">Run a model using the Oasis MDK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/running_a_model_using_the_Oasis_API.html">Run a model using the Oasis API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/running_a_model_using_the_Oasis_UI.html">Run a model using the Oasis UI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/FAQ.html">Frequently Asked Questions</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../developer_guide/platform_architecture.html">Platform architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developer_guide/development_approach.html">Development approach</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developer_guide/github_repositories.html">GitHub repositories</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developer_guide/technology_stack.html">Technology stack</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developer_guide/release_process.html">Release process</a></li>
</ul>
<p class="caption"><span class="caption-text">Modelling methodology</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../modelling_methodology/what_is_a_catastrophe_model.html">What is a catastrophe model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modelling_methodology/simulation_methodology.html">Simulation methodology</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modelling_methodology/financial_modelling_and_exposure_data.html">Financial modelling and exposure data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modelling_methodology/risk_metrics.html">Risk metrics</a></li>
</ul>
<p class="caption"><span class="caption-text">Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/oasis_rest_api.html">Oasis API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/oasis_mdk.html">Model Development Kit (MDK)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/modules.html">Module documentation</a></li>
</ul>
<p class="caption"><span class="caption-text">Release Notes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../releases/latest_release.html">Latest release</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Oasis LMF</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../../oasislmf.html">oasislmf</a> &raquo;</li>
        
      <li>oasislmf.model_preparation.oed</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for oasislmf.model_preparation.oed</h1><div class="highlight"><pre>
<span></span><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;load_oed_dfs&#39;</span><span class="p">,</span>
    <span class="s1">&#39;OedValidator&#39;</span>
<span class="p">]</span>

<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>

<span class="kn">from</span> <span class="nn">..utils.data</span> <span class="kn">import</span> <span class="n">get_dataframe</span>


<span class="c1"># TODO - add validator</span>
<div class="viewcode-block" id="OedValidator"><a class="viewcode-back" href="../../../autoapi/oasislmf/model_preparation/oed/index.html#oasislmf.model_preparation.oed.OedValidator">[docs]</a><span class="k">class</span> <span class="nc">OedValidator</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ri_info_rules</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ri_scope_rules</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rules_ode_scope</span> <span class="o">=</span> <span class="n">ri_info_rules</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rules_ode_info</span> <span class="o">=</span> <span class="n">ri_scope_rules</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ri_info_required_cols</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;ReinsNumber&#39;</span><span class="p">,</span> <span class="s1">&#39;ReinsPeril&#39;</span><span class="p">,</span> <span class="s1">&#39;PlacedPercent&#39;</span><span class="p">,</span>
            <span class="s1">&#39;InuringPriority&#39;</span><span class="p">,</span> <span class="s1">&#39;ReinsType&#39;</span>
        <span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ri_info_defaults</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;CededPercent&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
            <span class="s1">&#39;RiskLimit&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="s1">&#39;RiskAttachment&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="s1">&#39;OccLimit&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="s1">&#39;OccAttachment&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="s1">&#39;TreatyShare&#39;</span><span class="p">:</span> <span class="mf">0.0</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ri_scope_required_cols</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;ReinsNumber&#39;</span><span class="p">,</span> <span class="s1">&#39;RiskLevel&#39;</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">error_structure</span> <span class="o">=</span> <span class="p">{}</span>

<div class="viewcode-block" id="OedValidator._unique_reins"><a class="viewcode-back" href="../../../autoapi/oasislmf/model_preparation/oed/index.html#oasislmf.model_preparation.oed.OedValidator._unique_reins">[docs]</a>    <span class="k">def</span> <span class="nf">_unique_reins</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reins_info_df</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        check if only one reins type exisits</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">reins_info_df</span><span class="o">.</span><span class="n">ReinsType</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="OedValidator._find_missing"><a class="viewcode-back" href="../../../autoapi/oasislmf/model_preparation/oed/index.html#oasislmf.model_preparation.oed.OedValidator._find_missing">[docs]</a>    <span class="k">def</span> <span class="nf">_find_missing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df_src</span><span class="p">,</span> <span class="n">column_name</span><span class="p">,</span> <span class="n">df_dest</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        return list of values if df_dest[`column_name`] values do not exist in df_src</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">src_values</span> <span class="o">=</span> <span class="n">df_dest</span><span class="p">[</span><span class="n">column_name</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">missing_df</span> <span class="o">=</span> <span class="n">df_src</span><span class="p">[</span><span class="o">~</span><span class="n">df_src</span><span class="o">.</span><span class="n">isin</span><span class="p">({</span><span class="n">column_name</span><span class="p">:</span> <span class="n">src_values</span><span class="p">})]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">missing_df</span><span class="p">[</span><span class="n">column_name</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span></div>

<div class="viewcode-block" id="OedValidator._all_scope_non_specific"><a class="viewcode-back" href="../../../autoapi/oasislmf/model_preparation/oed/index.html#oasislmf.model_preparation.oed.OedValidator._all_scope_non_specific">[docs]</a>    <span class="k">def</span> <span class="nf">_all_scope_non_specific</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scope_df</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">scope_df</span><span class="p">[[</span><span class="s1">&#39;AccountNumber&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;PolicyNumber&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;LocationNumber&#39;</span></div>
                         <span class="p">]]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

<div class="viewcode-block" id="OedValidator._all_scope_specific"><a class="viewcode-back" href="../../../autoapi/oasislmf/model_preparation/oed/index.html#oasislmf.model_preparation.oed.OedValidator._all_scope_specific">[docs]</a>    <span class="k">def</span> <span class="nf">_all_scope_specific</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scope_df</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">scope_df</span><span class="p">[[</span><span class="s1">&#39;AccountNumber&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;PolicyNumber&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;LocationNumber&#39;</span></div>
                         <span class="p">]]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

<div class="viewcode-block" id="OedValidator._error_struture"><a class="viewcode-back" href="../../../autoapi/oasislmf/model_preparation/oed/index.html#oasislmf.model_preparation.oed.OedValidator._error_struture">[docs]</a>    <span class="k">def</span> <span class="nf">_error_struture</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">check_type</span><span class="p">,</span> <span class="n">chcek_scope</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;check&quot;</span><span class="p">:</span> <span class="n">check_type</span><span class="p">,</span>
            <span class="s2">&quot;scope&quot;</span><span class="p">:</span> <span class="n">chcek_scope</span><span class="p">,</span>
            <span class="s2">&quot;messsages&quot;</span><span class="p">:</span> <span class="n">msg</span><span class="p">,</span>
            <span class="s2">&quot;meta_data&quot;</span><span class="p">:</span> <span class="n">info</span><span class="p">,</span></div>
        <span class="p">}</span>

    <span class="c1"># def validate(self, account_df, location_df, ri_info_df, ri_scope_df):</span>
<div class="viewcode-block" id="OedValidator.validate"><a class="viewcode-back" href="../../../autoapi/oasislmf/model_preparation/oed/index.html#oasislmf.model_preparation.oed.OedValidator.validate">[docs]</a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ri_info_df</span><span class="p">,</span> <span class="n">ri_scope_df</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Validate OED resinurance structure before running calculations.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">error_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">inuring_priority</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ri_info_df</span><span class="p">[</span><span class="s1">&#39;InuringPriority&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">inuring_priority_ri_info_df</span> <span class="o">=</span> <span class="n">ri_info_df</span><span class="p">[</span><span class="n">ri_info_df</span><span class="o">.</span><span class="n">InuringPriority</span> <span class="o">==</span> <span class="n">inuring_priority</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">inuring_priority_ri_info_df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">inuring_scope_ids</span> <span class="o">=</span> <span class="n">inuring_priority_ri_info_df</span><span class="o">.</span><span class="n">ReinsNumber</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">inuring_scopes</span> <span class="o">=</span> <span class="p">[</span><span class="n">ri_scope_df</span><span class="p">[</span><span class="n">ri_scope_df</span><span class="o">.</span><span class="n">ReinsNumber</span> <span class="o">==</span> <span class="n">ID</span><span class="p">]</span> <span class="k">for</span> <span class="n">ID</span> <span class="ow">in</span> <span class="n">inuring_scope_ids</span><span class="p">]</span>
            <span class="n">reins_types_found</span> <span class="o">=</span> <span class="n">inuring_priority_ri_info_df</span><span class="o">.</span><span class="n">ReinsType</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

            <span class="n">meta_data</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;InuringPriority&quot;</span><span class="p">:</span> <span class="n">inuring_priority</span><span class="p">,</span>
                <span class="s2">&quot;ReinsTypes&quot;</span><span class="p">:</span> <span class="n">reins_types_found</span><span class="p">,</span>
                <span class="s2">&quot;ri_info_ReinsNumbers&quot;</span><span class="p">:</span> <span class="n">inuring_priority_ri_info_df</span><span class="o">.</span><span class="n">ReinsNumber</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                <span class="s2">&quot;ri_info_line_nums&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">inuring_priority_ri_info_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()],</span>
            <span class="p">}</span>

            <span class="c1"># CHECK - only single ri_type is set per inuring priority</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">reins_types_found</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">error_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_error_struture</span><span class="p">(</span>
                    <span class="s2">&quot;inuring_reins_type&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;RI_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inuring_priority</span><span class="p">),</span>
                    <span class="s2">&quot;Inuring layer must have a unique ReinsType.&quot;</span><span class="p">,</span>
                    <span class="n">meta_data</span>
                <span class="p">))</span>
                <span class="k">continue</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">reins_types_found</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">error_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_error_struture</span><span class="p">(</span>
                    <span class="s2">&quot;inuring_reins_type&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;RI_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inuring_priority</span><span class="p">),</span>
                    <span class="s2">&quot;Inuring layer missing a ReinsType.&quot;</span><span class="p">,</span>
                    <span class="n">meta_data</span>
                <span class="p">))</span>
                <span class="k">continue</span>

            <span class="c1"># CHECK - ri_type is supported</span>
            <span class="n">ri_type</span> <span class="o">=</span> <span class="n">reins_types_found</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">ri_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">REINS_TYPES</span><span class="p">:</span>
                <span class="n">error_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_error_struture</span><span class="p">(</span>
                    <span class="s2">&quot;inuring_reins_type&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;RI_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inuring_priority</span><span class="p">),</span>
                    <span class="s2">&quot;Unsupported ReinsType&quot;</span><span class="p">,</span>
                    <span class="n">meta_data</span>
                <span class="p">))</span>

            <span class="c1"># CHECK scope of inuring layer</span>
            <span class="k">for</span> <span class="n">scope_df</span> <span class="ow">in</span> <span class="n">inuring_scopes</span><span class="p">:</span>
                <span class="n">scope_risk_levels</span> <span class="o">=</span> <span class="n">scope_df</span><span class="o">.</span><span class="n">RiskLevel</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
                <span class="n">meta_data</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
                    <span class="s2">&quot;RiskLevels&quot;</span><span class="p">:</span> <span class="n">scope_risk_levels</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                    <span class="s2">&quot;ri_scope_ReinsNumber&quot;</span><span class="p">:</span> <span class="n">scope_df</span><span class="o">.</span><span class="n">ReinsNumber</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                    <span class="s2">&quot;ri_scope_line_nums&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">scope_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()],</span>
                <span class="p">})</span>
                <span class="c1"># CHECK - each scope only has one risk level type</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">scope_risk_levels</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">error_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_error_struture</span><span class="p">(</span>
                        <span class="s2">&quot;inuring_risk_level&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;RI_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inuring_priority</span><span class="p">),</span>
                        <span class="s2">&quot;Mix of risk levels in a single reinsurance scope&quot;</span><span class="p">,</span>
                        <span class="n">meta_data</span><span class="p">,</span>
                    <span class="p">))</span>
                    <span class="k">continue</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">scope_risk_levels</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">error_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_error_struture</span><span class="p">(</span>
                        <span class="s2">&quot;inuring_risk_level&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;RI_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inuring_priority</span><span class="p">),</span>
                        <span class="s2">&quot;inuring layer has no reinsurance scope&quot;</span><span class="p">,</span>
                        <span class="n">meta_data</span><span class="p">,</span>
                    <span class="p">))</span>
                    <span class="k">continue</span>

                <span class="c1"># CHECK - Risk level is supported</span>
                <span class="n">risk_level_id</span> <span class="o">=</span> <span class="n">scope_risk_levels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">risk_level_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">SUPPORTED_RISK_LEVELS</span><span class="p">[</span><span class="n">ri_type</span><span class="p">]:</span>
                    <span class="n">error_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_error_struture</span><span class="p">(</span>
                        <span class="s2">&quot;inuring_risk_level&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;RI_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inuring_priority</span><span class="p">),</span>
                        <span class="s2">&quot;Unsupported risk level&quot;</span><span class="p">,</span>
                        <span class="n">meta_data</span><span class="p">,</span>
                    <span class="p">))</span>

        <span class="k">return</span> <span class="p">(</span><span class="ow">not</span> <span class="n">error_list</span><span class="p">,</span> <span class="n">error_list</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="load_oed_dfs"><a class="viewcode-back" href="../../../autoapi/oasislmf/model_preparation/oed/index.html#oasislmf.model_preparation.oed.load_oed_dfs">[docs]</a><span class="k">def</span> <span class="nf">load_oed_dfs</span><span class="p">(</span><span class="n">oed_ri_info_file</span><span class="p">,</span> <span class="n">oed_ri_scope_file</span><span class="p">,</span> <span class="n">show_all</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load OED data files.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">do_reinsurance</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">oed_ri_info_file_exists</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">oed_ri_info_file</span><span class="p">)</span>
    <span class="n">oed_ri_scope_file_exists</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">oed_ri_scope_file</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">oed_ri_info_file_exists</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">oed_ri_scope_file_exists</span><span class="p">:</span>
        <span class="n">ri_info_df</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">ri_scope_df</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">do_reinsurance</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">elif</span> <span class="n">oed_ri_info_file_exists</span> <span class="ow">and</span> <span class="n">oed_ri_scope_file_exists</span><span class="p">:</span>
        <span class="n">ri_info_df</span> <span class="o">=</span> <span class="n">get_dataframe</span><span class="p">(</span>
            <span class="n">oed_ri_info_file</span><span class="p">,</span> <span class="n">lowercase_cols</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">required_cols</span><span class="o">=</span><span class="n">RI_INFO_REQUIRED_COLS</span><span class="p">,</span>
            <span class="n">col_defaults</span><span class="o">=</span><span class="n">RI_INFO_DEFAULTS</span><span class="p">,</span>
            <span class="n">col_dtypes</span><span class="o">=</span><span class="n">RI_INFO_DTYPES</span><span class="p">)</span>
        <span class="n">ri_scope_df</span> <span class="o">=</span> <span class="n">get_dataframe</span><span class="p">(</span>
            <span class="n">oed_ri_scope_file</span><span class="p">,</span> <span class="n">lowercase_cols</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">required_cols</span><span class="o">=</span><span class="n">RI_SCOPE_REQUIRED_COLS</span><span class="p">,</span>
            <span class="n">col_defaults</span><span class="o">=</span><span class="n">RI_SCOPE_DEFAULTS</span><span class="p">,</span>
            <span class="n">col_dtypes</span><span class="o">=</span><span class="n">RI_SCOPE_DTYPES</span><span class="p">)</span>

        <span class="c1"># Treat empty Risk Level as portfolio level scope.</span>
        <span class="c1"># Also need nan, as this is produced when</span>
        <span class="c1"># a single row with empty Risk Level is loaded.</span>
        <span class="n">ri_scope_df</span><span class="o">.</span><span class="n">RiskLevel</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">REINS_RISK_LEVEL_PORTFOLIO</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Both reinsurance files must exist: </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">oed_ri_info_file</span><span class="p">,</span> <span class="n">oed_ri_scope_file</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">do_reinsurance</span><span class="p">:</span>
        <span class="n">ri_info_df</span> <span class="o">=</span> <span class="n">ri_info_df</span><span class="p">[</span><span class="n">OED_REINS_INFO_FIELDS</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">ri_scope_df</span> <span class="o">=</span> <span class="n">ri_scope_df</span><span class="p">[</span><span class="n">OED_REINS_SCOPE_FIELDS</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># Ensure Percent feilds are float</span>
        <span class="n">info_float_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CededPercent&#39;</span><span class="p">,</span> <span class="s1">&#39;PlacedPercent&#39;</span><span class="p">,</span> <span class="s1">&#39;TreatyShare&#39;</span><span class="p">]</span>
        <span class="n">scope_float_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CededPercent&#39;</span><span class="p">]</span>
        <span class="n">ri_info_df</span><span class="p">[</span><span class="n">info_float_cols</span><span class="p">]</span> <span class="o">=</span> <span class="n">ri_info_df</span><span class="p">[</span><span class="n">info_float_cols</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">ri_scope_df</span><span class="p">[</span><span class="n">scope_float_cols</span><span class="p">]</span> <span class="o">=</span> <span class="n">ri_scope_df</span><span class="p">[</span><span class="n">scope_float_cols</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">ri_info_df</span><span class="p">,</span> <span class="n">ri_scope_df</span><span class="p">,</span> <span class="n">do_reinsurance</span><span class="p">)</span></div>

<span class="c1">#</span>
<span class="c1"># Ktools constants</span>
<span class="c1">#</span>


<span class="n">DEDUCTIBLE_AND_LIMIT_CALCRULE_ID</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">FRANCHISE_DEDUCTIBLE_AND_LIMIT_CALCRULE_ID</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">DEDUCTIBLE_ONLY_CALCRULE_ID</span> <span class="o">=</span> <span class="mi">12</span>
<span class="n">DEDUCTIBLE_AS_A_CAP_ON_THE_RETENTION_OF_INPUT_LOSSES_CALCRULE_ID</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">DEDUCTIBLE_AS_A_FLOOR_ON_THE_RETENTION_OF_INPUT_LOSSES_CALCRULE_ID</span> <span class="o">=</span> <span class="mi">11</span>
<span class="n">DEDUCTIBLE_LIMIT_AND_SHARE_CALCRULE_ID</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">DEDUCTIBLE_AND_LIMIT_AS_A_PROPORTION_OF_LOSS_CALCRUKE_ID</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">DEDUCTIBLE_WITH_LIMIT_AS_A_PROPORTION_OF_LOSS_CALCRUKE_ID</span> <span class="o">=</span> <span class="mi">9</span>
<span class="n">LIMIT_ONLY_CALCRULE_ID</span> <span class="o">=</span> <span class="mi">14</span>
<span class="n">LIMIT_AS_A_PROPORTION_OF_LOSS_CALCRULE_ID</span> <span class="o">=</span> <span class="mi">15</span>
<span class="n">DEDUCTIBLE_AS_A_PROPORTION_OF_LOSS_CALCRULE_ID</span> <span class="o">=</span> <span class="mi">16</span>

<span class="n">CALCRULE_ID_DEDUCTIBLE_AND_LIMIT</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">CALCRULE_ID_DEDUCTIBLE_ATTACHMENT_LIMIT_AND_SHARE</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">CALCRULE_ID_FRANCHISE_DEDUCTIBLE_AND_LIMIT</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">CALCRULE_ID_DEDUCTIBLE_AND_LIMIT_PERCENT_TIV</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">CALCRULE_ID_DEDUCTIBLE_AND_LIMIT_PERCENT_LOSS</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">CALCRULE_ID_DEDUCTIBLE_PERCENT_TIV</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">CALCRULE_ID_LIMIT_AND_MAX_DEDUCTIBLE</span> <span class="o">=</span> <span class="mi">7</span>
<span class="n">CALCRULE_ID_LIMIT_AND_MIN_DEDUCTIBLE</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">CALCRULE_ID_LIMIT_WITH_DEDUCTIBLE_PERCENT_LIMIT</span> <span class="o">=</span> <span class="mi">9</span>
<span class="n">CALCRULE_ID_MAX_DEDUCTIBLE</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">CALCRULE_ID_MIN_DEDUCTIBLE</span> <span class="o">=</span> <span class="mi">11</span>
<span class="n">CALCRULE_ID_DEDUCTIBLE_ONLY</span> <span class="o">=</span> <span class="mi">12</span>
<span class="n">CALCRULE_ID_MAIN_AND_MAX_DEDUCTIBLE</span> <span class="o">=</span> <span class="mi">13</span>
<span class="n">CALCRULE_ID_LIMIT_ONLY</span> <span class="o">=</span> <span class="mi">14</span>
<span class="n">CALCRULE_ID_LIMIT_PERCENT_LOSS</span> <span class="o">=</span> <span class="mi">15</span>
<span class="n">CALCRULE_ID_DEDUCTIBLE_PERCENT_LOSS</span> <span class="o">=</span> <span class="mi">16</span>
<span class="n">CALCRULE_ID_DEDUCTIBLE_PERCENT_LOSS_ATTACHMENT_LIMIT_AND_SHARE</span> <span class="o">=</span> <span class="mi">17</span>
<span class="n">CALCRULE_ID_DEDUCTIBLE_PERCENT_TIV_ATTACHMENT_LIMIT_AND_SHARE</span> <span class="o">=</span> <span class="mi">18</span>
<span class="n">CALCRULE_ID_DEDUCTIBLE_PERCENT_LOSS_WITH_MIN_AND_MAX</span> <span class="o">=</span> <span class="mi">19</span>
<span class="n">CALCRULE_ID_REVERSE_FRANCHISE_DEDUCTIBLE</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">CALCRULE_ID_SHARE_AND_LIMIT</span> <span class="o">=</span> <span class="mi">21</span>
<span class="n">CALCRULE_ID_QUOTA_SHARE</span> <span class="o">=</span> <span class="mi">22</span>
<span class="n">CALCRULE_ID_OCCURRENCE_LIMIT_AND_SHARE</span> <span class="o">=</span> <span class="mi">23</span>
<span class="n">CALCRULE_ID_OCCURRENCE_CATASTROPHE_EXCESS_OF_LOSS</span> <span class="o">=</span> <span class="mi">24</span>
<span class="n">CALCRULE_ID_FACULTATIVE_WITH_POLICY_SHARE</span> <span class="o">=</span> <span class="mi">25</span>

<span class="n">NO_ALLOCATION_ALLOC_ID</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">ALLOCATE_TO_ITEMS_BY_GUL_ALLOC_ID</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">ALLOCATE_TO_ITEMS_BY_PREVIOUS_LEVEL_ALLOC_ID</span> <span class="o">=</span> <span class="mi">2</span>

<span class="n">BUILDING_COVERAGE_TYPE_ID</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">OTHER_BUILDING_COVERAGE_TYPE_ID</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">CONTENTS_COVERAGE_TYPE_ID</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">TIME_COVERAGE_TYPE_ID</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">COVERAGE_TYPES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">BUILDING_COVERAGE_TYPE_ID</span><span class="p">,</span>
    <span class="n">OTHER_BUILDING_COVERAGE_TYPE_ID</span><span class="p">,</span>
    <span class="n">CONTENTS_COVERAGE_TYPE_ID</span><span class="p">,</span>
    <span class="n">TIME_COVERAGE_TYPE_ID</span><span class="p">]</span>

<span class="n">PERIL_WIND</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">PERILS</span> <span class="o">=</span> <span class="p">[</span><span class="n">PERIL_WIND</span><span class="p">]</span>

<span class="n">GUL_INPUTS_FILES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;coverages&#39;</span><span class="p">,</span>
    <span class="s1">&#39;gulsummaryxref&#39;</span><span class="p">,</span>
    <span class="s1">&#39;items&#39;</span><span class="p">]</span>

<span class="n">IL_INPUTS_FILES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;fm_policytc&#39;</span><span class="p">,</span>
    <span class="s1">&#39;fm_profile&#39;</span><span class="p">,</span>
    <span class="s1">&#39;fm_programme&#39;</span><span class="p">,</span>
    <span class="s1">&#39;fm_xref&#39;</span><span class="p">,</span>
    <span class="s1">&#39;fmsummaryxref&#39;</span><span class="p">]</span>

<span class="n">OPTIONAL_INPUTS_FILES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;events&#39;</span><span class="p">]</span>

<span class="n">CONVERSION_TOOLS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;coverages&#39;</span><span class="p">:</span> <span class="s1">&#39;coveragetobin&#39;</span><span class="p">,</span>
    <span class="s1">&#39;events&#39;</span><span class="p">:</span> <span class="s1">&#39;evetobin&#39;</span><span class="p">,</span>
    <span class="s1">&#39;fm_policytc&#39;</span><span class="p">:</span> <span class="s1">&#39;fmpolicytctobin&#39;</span><span class="p">,</span>
    <span class="s1">&#39;fm_profile&#39;</span><span class="p">:</span> <span class="s1">&#39;fmprofiletobin&#39;</span><span class="p">,</span>
    <span class="s1">&#39;fm_programme&#39;</span><span class="p">:</span> <span class="s1">&#39;fmprogrammetobin&#39;</span><span class="p">,</span>
    <span class="s1">&#39;fm_xref&#39;</span><span class="p">:</span> <span class="s1">&#39;fmxreftobin&#39;</span><span class="p">,</span>
    <span class="s1">&#39;fmsummaryxref&#39;</span><span class="p">:</span> <span class="s1">&#39;fmsummaryxreftobin&#39;</span><span class="p">,</span>
    <span class="s1">&#39;gulsummaryxref&#39;</span><span class="p">:</span> <span class="s1">&#39;gulsummaryxreftobin&#39;</span><span class="p">,</span>
    <span class="s1">&#39;items&#39;</span><span class="p">:</span> <span class="s2">&quot;itemtobin&quot;</span><span class="p">}</span>


<span class="n">NOT_SET_ID</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">LARGE_VALUE</span> <span class="o">=</span> <span class="mi">9999999999999</span>


<span class="c1"># --- OED constants --------------------------------------------------------- #</span>
<span class="n">RI_INFO_REQUIRED_COLS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;ReinsNumber&#39;</span><span class="p">,</span>
    <span class="s1">&#39;PlacedPercent&#39;</span><span class="p">,</span>
    <span class="s1">&#39;InuringPriority&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ReinsType&#39;</span>
<span class="p">]</span>

<span class="n">RI_INFO_DEFAULTS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;CededPercent&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="s1">&#39;RiskLimit&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="s1">&#39;RiskAttachment&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="s1">&#39;OccLimit&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="s1">&#39;OccAttachment&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="s1">&#39;TreatyShare&#39;</span><span class="p">:</span> <span class="mf">1.0</span>
<span class="p">}</span>

<span class="n">RI_SCOPE_REQUIRED_COLS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;ReinsNumber&#39;</span><span class="p">,</span>
    <span class="s1">&#39;RiskLevel&#39;</span>
<span class="p">}</span>

<span class="n">RI_SCOPE_DEFAULTS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;PortNumber&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="s1">&#39;AccNumber&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="s1">&#39;PolNumber&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="s1">&#39;LocGroup&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="s1">&#39;LocNumber&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="s1">&#39;CedantName&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ProducerName&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="s1">&#39;LOB&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="s1">&#39;CountryCode&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ReinsTag&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="s1">&#39;CededPercent&#39;</span><span class="p">:</span> <span class="mf">1.0</span>
<span class="p">}</span>

<span class="n">RI_INFO_DTYPES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;ReinsNumber&#39;</span><span class="p">:</span> <span class="s2">&quot;int&quot;</span><span class="p">,</span>
    <span class="s1">&#39;CededPercent&#39;</span><span class="p">:</span> <span class="s2">&quot;float&quot;</span><span class="p">,</span>
    <span class="s1">&#39;RiskLimit&#39;</span><span class="p">:</span> <span class="s2">&quot;float&quot;</span><span class="p">,</span>
    <span class="s1">&#39;RiskAttachment&#39;</span><span class="p">:</span> <span class="s2">&quot;float&quot;</span><span class="p">,</span>
    <span class="s1">&#39;OccLimit&#39;</span><span class="p">:</span> <span class="s2">&quot;float&quot;</span><span class="p">,</span>
    <span class="s1">&#39;OccAttachment&#39;</span><span class="p">:</span> <span class="s2">&quot;float&quot;</span><span class="p">,</span>
    <span class="s1">&#39;InuringPriority&#39;</span><span class="p">:</span> <span class="s2">&quot;int&quot;</span><span class="p">,</span>
    <span class="s1">&#39;ReinsType&#39;</span><span class="p">:</span> <span class="s2">&quot;str&quot;</span><span class="p">,</span>
    <span class="s1">&#39;PlacedPercent&#39;</span><span class="p">:</span> <span class="s2">&quot;float&quot;</span><span class="p">,</span>
    <span class="s1">&#39;TreatyShare&#39;</span><span class="p">:</span> <span class="s2">&quot;float&quot;</span>
<span class="p">}</span>

<span class="n">RI_SCOPE_DTYPES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;ReinsNumber&#39;</span><span class="p">:</span> <span class="s2">&quot;int&quot;</span><span class="p">,</span>
    <span class="s1">&#39;PortNumber&#39;</span><span class="p">:</span> <span class="s2">&quot;str&quot;</span><span class="p">,</span>
    <span class="s1">&#39;AccNumber&#39;</span><span class="p">:</span> <span class="s2">&quot;str&quot;</span><span class="p">,</span>
    <span class="s1">&#39;LocGroup&#39;</span><span class="p">:</span> <span class="s2">&quot;str&quot;</span><span class="p">,</span>
    <span class="s1">&#39;PolNumber&#39;</span><span class="p">:</span> <span class="s2">&quot;str&quot;</span><span class="p">,</span>
    <span class="s1">&#39;LocNumber&#39;</span><span class="p">:</span> <span class="s2">&quot;str&quot;</span><span class="p">,</span>
    <span class="s1">&#39;CedantName&#39;</span><span class="p">:</span> <span class="s2">&quot;str&quot;</span><span class="p">,</span>
    <span class="s1">&#39;ProducerName&#39;</span><span class="p">:</span> <span class="s2">&quot;str&quot;</span><span class="p">,</span>
    <span class="s1">&#39;LOB&#39;</span><span class="p">:</span> <span class="s2">&quot;str&quot;</span><span class="p">,</span>
    <span class="s1">&#39;CountryCode&#39;</span><span class="p">:</span> <span class="s2">&quot;str&quot;</span><span class="p">,</span>
    <span class="s1">&#39;ReinsTag&#39;</span><span class="p">:</span> <span class="s2">&quot;str&quot;</span><span class="p">,</span>
    <span class="s1">&#39;RiskLevel&#39;</span><span class="p">:</span> <span class="s2">&quot;str&quot;</span><span class="p">,</span>
    <span class="s1">&#39;CededPercent&#39;</span><span class="p">:</span> <span class="s2">&quot;float&quot;</span>
<span class="p">}</span>


<span class="n">POLICYITEM_LEVEL</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">LOCATION_LEVEL</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">POLICY_LEVEL</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">ACCOUNT_LEVEL</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">OCCURRENCE_LEVEL</span> <span class="o">=</span> <span class="mi">4</span>

<span class="n">PASSTHROUGH_NODE_TYPE</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">NOLOSS_NODE_TYPE</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">REINS_TYPE_FAC</span> <span class="o">=</span> <span class="s2">&quot;FAC&quot;</span>
<span class="n">REINS_TYPE_QUOTA_SHARE</span> <span class="o">=</span> <span class="s2">&quot;QS&quot;</span>
<span class="n">REINS_TYPE_SURPLUS_SHARE</span> <span class="o">=</span> <span class="s2">&quot;SS&quot;</span>
<span class="n">REINS_TYPE_PER_RISK</span> <span class="o">=</span> <span class="s2">&quot;PR&quot;</span>
<span class="n">REINS_TYPE_CAT_XL</span> <span class="o">=</span> <span class="s2">&quot;CXL&quot;</span>
<span class="n">REINS_TYPE_AGG_XL</span> <span class="o">=</span> <span class="s2">&quot;AXL&quot;</span>
<span class="n">REINS_TYPES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">REINS_TYPE_FAC</span><span class="p">,</span>
    <span class="n">REINS_TYPE_QUOTA_SHARE</span><span class="p">,</span>
    <span class="n">REINS_TYPE_SURPLUS_SHARE</span><span class="p">,</span>
    <span class="n">REINS_TYPE_PER_RISK</span><span class="p">,</span>
    <span class="n">REINS_TYPE_CAT_XL</span>
<span class="p">]</span>

<span class="n">REINS_RISK_LEVEL_PORTFOLIO</span> <span class="o">=</span> <span class="s2">&quot;SEL&quot;</span>
<span class="n">REINS_RISK_LEVEL_LOCATION</span> <span class="o">=</span> <span class="s2">&quot;LOC&quot;</span>
<span class="n">REINS_RISK_LEVEL_LOCATION_GROUP</span> <span class="o">=</span> <span class="s2">&quot;LGR&quot;</span>
<span class="n">REINS_RISK_LEVEL_POLICY</span> <span class="o">=</span> <span class="s2">&quot;POL&quot;</span>
<span class="n">REINS_RISK_LEVEL_ACCOUNT</span> <span class="o">=</span> <span class="s2">&quot;ACC&quot;</span>
<span class="n">REINS_RISK_LEVELS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">REINS_RISK_LEVEL_LOCATION</span><span class="p">,</span>
    <span class="n">REINS_RISK_LEVEL_LOCATION_GROUP</span><span class="p">,</span>
    <span class="n">REINS_RISK_LEVEL_POLICY</span><span class="p">,</span>
    <span class="n">REINS_RISK_LEVEL_ACCOUNT</span><span class="p">,</span>
    <span class="n">REINS_RISK_LEVEL_PORTFOLIO</span><span class="p">,</span>
<span class="p">]</span>


<span class="n">SUPPORTED_RISK_LEVELS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">REINS_TYPE_FAC</span><span class="p">:</span> <span class="p">[</span><span class="n">REINS_RISK_LEVEL_LOCATION</span><span class="p">,</span> <span class="n">REINS_RISK_LEVEL_LOCATION_GROUP</span><span class="p">,</span> <span class="n">REINS_RISK_LEVEL_POLICY</span><span class="p">,</span> <span class="n">REINS_RISK_LEVEL_ACCOUNT</span><span class="p">],</span>
    <span class="n">REINS_TYPE_SURPLUS_SHARE</span><span class="p">:</span> <span class="p">[</span><span class="n">REINS_RISK_LEVEL_LOCATION</span><span class="p">,</span> <span class="n">REINS_RISK_LEVEL_LOCATION_GROUP</span><span class="p">,</span> <span class="n">REINS_RISK_LEVEL_POLICY</span><span class="p">,</span> <span class="n">REINS_RISK_LEVEL_ACCOUNT</span><span class="p">],</span>
    <span class="n">REINS_TYPE_PER_RISK</span><span class="p">:</span> <span class="p">[</span><span class="n">REINS_RISK_LEVEL_LOCATION</span><span class="p">,</span> <span class="n">REINS_RISK_LEVEL_LOCATION_GROUP</span><span class="p">,</span> <span class="n">REINS_RISK_LEVEL_POLICY</span><span class="p">,</span> <span class="n">REINS_RISK_LEVEL_ACCOUNT</span><span class="p">],</span>
    <span class="n">REINS_TYPE_CAT_XL</span><span class="p">:</span> <span class="p">[</span><span class="n">REINS_RISK_LEVEL_PORTFOLIO</span><span class="p">],</span>
    <span class="n">REINS_TYPE_QUOTA_SHARE</span><span class="p">:</span> <span class="n">REINS_RISK_LEVELS</span>
<span class="p">}</span>

<span class="c1"># Subset of the fields that are currently used</span>
<span class="n">OED_ACCOUNT_FIELDS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;PortNumber&#39;</span><span class="p">,</span>
    <span class="s1">&#39;AccNumber&#39;</span><span class="p">,</span>
    <span class="s1">&#39;PolNumber&#39;</span><span class="p">,</span>
    <span class="s1">&#39;AccPeril&#39;</span><span class="p">,</span>
    <span class="s1">&#39;AccDed6All&#39;</span><span class="p">,</span>
    <span class="s1">&#39;AccLimit6All&#39;</span>
<span class="p">]</span>

<span class="n">OED_LOCATION_FIELDS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;AccNumber&#39;</span><span class="p">,</span>
    <span class="s1">&#39;LocGroup&#39;</span><span class="p">,</span>
    <span class="s1">&#39;LocNumber&#39;</span><span class="p">,</span>
    <span class="s1">&#39;LocDed6All&#39;</span><span class="p">,</span>
    <span class="s1">&#39;LocLimit6All&#39;</span><span class="p">,</span>
    <span class="s1">&#39;BuildingTIV&#39;</span><span class="p">,</span>
    <span class="s1">&#39;OtherTIV&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ContentsTIV&#39;</span><span class="p">,</span>
    <span class="s1">&#39;BITIV&#39;</span>
<span class="p">]</span>

<span class="n">OED_REINS_INFO_FIELDS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;ReinsNumber&#39;</span><span class="p">,</span>
    <span class="s1">&#39;CededPercent&#39;</span><span class="p">,</span>
    <span class="s1">&#39;RiskLimit&#39;</span><span class="p">,</span>
    <span class="s1">&#39;RiskAttachment&#39;</span><span class="p">,</span>
    <span class="s1">&#39;OccLimit&#39;</span><span class="p">,</span>
    <span class="s1">&#39;OccAttachment&#39;</span><span class="p">,</span>
    <span class="s1">&#39;InuringPriority&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ReinsType&#39;</span><span class="p">,</span>
    <span class="s1">&#39;PlacedPercent&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TreatyShare&#39;</span>
<span class="p">]</span>

<span class="n">OED_REINS_SCOPE_FIELDS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;ReinsNumber&#39;</span><span class="p">,</span>
    <span class="s1">&#39;PortNumber&#39;</span><span class="p">,</span>
    <span class="s1">&#39;AccNumber&#39;</span><span class="p">,</span>
    <span class="s1">&#39;PolNumber&#39;</span><span class="p">,</span>
    <span class="s1">&#39;LocGroup&#39;</span><span class="p">,</span>
    <span class="s1">&#39;LocNumber&#39;</span><span class="p">,</span>
    <span class="s1">&#39;CedantName&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ProducerName&#39;</span><span class="p">,</span>
    <span class="s1">&#39;LOB&#39;</span><span class="p">,</span>
    <span class="s1">&#39;CountryCode&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ReinsTag&#39;</span><span class="p">,</span>
    <span class="s1">&#39;RiskLevel&#39;</span><span class="p">,</span>
    <span class="s1">&#39;CededPercent&#39;</span>
<span class="p">]</span>

<span class="n">InuringLayer</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span>
    <span class="s2">&quot;InuringLayer&quot;</span><span class="p">,</span>
    <span class="s2">&quot;inuring_priority reins_numbers is_valid validation_messages&quot;</span><span class="p">)</span>
<span class="n">Item</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span>
    <span class="s2">&quot;Item&quot;</span><span class="p">,</span> <span class="s2">&quot;item_id coverage_id areaperil_id vulnerability_id group_id&quot;</span><span class="p">)</span>
<span class="n">Coverage</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span>
    <span class="s2">&quot;Coverage&quot;</span><span class="p">,</span> <span class="s2">&quot;coverage_id tiv&quot;</span><span class="p">)</span>
<span class="n">FmProgramme</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span>
    <span class="s2">&quot;FmProgramme&quot;</span><span class="p">,</span> <span class="s2">&quot;from_agg_id level_id to_agg_id&quot;</span><span class="p">)</span>
<span class="n">FmProfile</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span>
    <span class="s2">&quot;FmProfile&quot;</span><span class="p">,</span> <span class="s2">&quot;profile_id calcrule_id deductible1 deductible2 deductible3 attachment limit share1 share2 share3&quot;</span><span class="p">)</span>
<span class="n">FmPolicyTc</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span>
    <span class="s2">&quot;FmPolicyTc&quot;</span><span class="p">,</span> <span class="s2">&quot;layer_id level_id agg_id profile_id&quot;</span><span class="p">)</span>
<span class="n">GulSummaryXref</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span>
    <span class="s2">&quot;GulSummaryXref&quot;</span><span class="p">,</span> <span class="s2">&quot;coverage_id summary_id summaryset_id&quot;</span><span class="p">)</span>
<span class="n">FmSummaryXref</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span>
    <span class="s2">&quot;FmSummaryXref&quot;</span><span class="p">,</span> <span class="s2">&quot;output_id summary_id summaryset_id&quot;</span><span class="p">)</span>
<span class="n">FmXref</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span>
    <span class="s2">&quot;FmXref&quot;</span><span class="p">,</span> <span class="s2">&quot;output_id agg_id layer_id&quot;</span><span class="p">)</span>

<span class="n">XrefDescription</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span>
    <span class="s2">&quot;Description&quot;</span><span class="p">,</span>
    <span class="p">(</span>
        <span class="s2">&quot;xref_id portfolio_number policy_number account_number location_number location_group &quot;</span>
        <span class="s2">&quot;cedant_name producer_name lob country_code reins_tag coverage_type_id peril_id tiv&quot;</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">GulRecord</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s2">&quot;GulRecord&quot;</span><span class="p">,</span> <span class="s2">&quot;event_id item_id sidx loss&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">get_no_loss_profile</span><span class="p">(</span><span class="n">profile_id</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">FmProfile</span><span class="p">(</span>
        <span class="n">profile_id</span><span class="o">=</span><span class="n">profile_id</span><span class="p">,</span>
        <span class="n">calcrule_id</span><span class="o">=</span><span class="n">CALCRULE_ID_LIMIT_ONLY</span><span class="p">,</span>
        <span class="n">deductible1</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>  <span class="c1"># Not used</span>
        <span class="n">deductible2</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>  <span class="c1"># Not used</span>
        <span class="n">deductible3</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>  <span class="c1"># Not used</span>
        <span class="n">attachment</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>   <span class="c1"># Not used</span>
        <span class="n">limit</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="n">share1</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>       <span class="c1"># Not used</span>
        <span class="n">share2</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>       <span class="c1"># Not used</span>
        <span class="n">share3</span><span class="o">=</span><span class="mf">0.0</span>        <span class="c1"># Not used</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">get_pass_through_profile</span><span class="p">(</span><span class="n">profile_id</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">FmProfile</span><span class="p">(</span>
        <span class="n">profile_id</span><span class="o">=</span><span class="n">profile_id</span><span class="p">,</span>
        <span class="n">calcrule_id</span><span class="o">=</span><span class="n">CALCRULE_ID_DEDUCTIBLE_ONLY</span><span class="p">,</span>
        <span class="n">deductible1</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="n">deductible2</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>  <span class="c1"># Not used</span>
        <span class="n">deductible3</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>  <span class="c1"># Not used</span>
        <span class="n">attachment</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>   <span class="c1"># Not used</span>
        <span class="n">limit</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>        <span class="c1"># Not used</span>
        <span class="n">share1</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>       <span class="c1"># Not used</span>
        <span class="n">share2</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>       <span class="c1"># Not used</span>
        <span class="n">share3</span><span class="o">=</span><span class="mf">0.0</span>        <span class="c1"># Not used</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">get_profile</span><span class="p">(</span>
    <span class="n">profile_id</span><span class="p">,</span>
    <span class="n">deductible</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">attachment</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">limit</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">share</span><span class="o">=</span><span class="mf">1.0</span>
<span class="p">):</span>

    <span class="k">if</span> <span class="n">limit</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">limit</span> <span class="o">=</span> <span class="n">LARGE_VALUE</span>

    <span class="k">return</span> <span class="n">FmProfile</span><span class="p">(</span>
        <span class="n">profile_id</span><span class="o">=</span><span class="n">profile_id</span><span class="p">,</span>
        <span class="n">calcrule_id</span><span class="o">=</span><span class="n">CALCRULE_ID_DEDUCTIBLE_ATTACHMENT_LIMIT_AND_SHARE</span><span class="p">,</span>
        <span class="n">deductible1</span><span class="o">=</span><span class="n">deductible</span><span class="p">,</span>
        <span class="n">deductible2</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>  <span class="c1"># Not used</span>
        <span class="n">deductible3</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>  <span class="c1"># Not used</span>
        <span class="n">attachment</span><span class="o">=</span><span class="n">attachment</span><span class="p">,</span>
        <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span>
        <span class="n">share1</span><span class="o">=</span><span class="n">share</span><span class="p">,</span>
        <span class="n">share2</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>       <span class="c1"># Not used</span>
        <span class="n">share3</span><span class="o">=</span><span class="mf">0.0</span>        <span class="c1"># Not used</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">_value_is_empty</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="ow">or</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">math</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">get_reinsurance_profile</span><span class="p">(</span>
    <span class="n">profile_id</span><span class="p">,</span>
    <span class="n">attachment</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
    <span class="n">limit</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
    <span class="n">ceded</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="n">placement</span><span class="o">=</span><span class="mf">1.0</span>
<span class="p">):</span>

    <span class="k">if</span> <span class="n">_value_is_empty</span><span class="p">(</span><span class="n">attachment</span><span class="p">):</span>
        <span class="n">attachment</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">if</span> <span class="n">_value_is_empty</span><span class="p">(</span><span class="n">limit</span><span class="p">)</span> <span class="ow">or</span> <span class="n">limit</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">limit</span> <span class="o">=</span> <span class="n">LARGE_VALUE</span>
    <span class="k">if</span> <span class="n">_value_is_empty</span><span class="p">(</span><span class="n">ceded</span><span class="p">):</span>
        <span class="n">ceded</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="k">if</span> <span class="n">_value_is_empty</span><span class="p">(</span><span class="n">placement</span><span class="p">):</span>
        <span class="n">placement</span> <span class="o">=</span> <span class="mf">1.0</span>

    <span class="k">return</span> <span class="n">FmProfile</span><span class="p">(</span>
        <span class="n">profile_id</span><span class="o">=</span><span class="n">profile_id</span><span class="p">,</span>
        <span class="n">calcrule_id</span><span class="o">=</span><span class="n">CALCRULE_ID_OCCURRENCE_CATASTROPHE_EXCESS_OF_LOSS</span><span class="p">,</span>
        <span class="n">deductible1</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>          <span class="c1"># Not used</span>
        <span class="n">deductible2</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>          <span class="c1"># Not used</span>
        <span class="n">deductible3</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>          <span class="c1"># Not used</span>
        <span class="n">attachment</span><span class="o">=</span><span class="n">attachment</span><span class="p">,</span>
        <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span>
        <span class="n">share1</span><span class="o">=</span><span class="n">ceded</span><span class="p">,</span>
        <span class="n">share2</span><span class="o">=</span><span class="n">placement</span><span class="p">,</span>       <span class="c1"># PlacementPercent</span>
        <span class="n">share3</span><span class="o">=</span><span class="mf">1.0</span>              <span class="c1"># Not used</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">get_occlim_profile</span><span class="p">(</span>
    <span class="n">profile_id</span><span class="p">,</span>
    <span class="n">attachment</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
    <span class="n">limit</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
    <span class="n">ceded</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="n">placement</span><span class="o">=</span><span class="mf">1.0</span>
<span class="p">):</span>

    <span class="k">if</span> <span class="n">limit</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">limit</span> <span class="o">=</span> <span class="n">LARGE_VALUE</span>

    <span class="k">return</span> <span class="n">FmProfile</span><span class="p">(</span>
        <span class="n">profile_id</span><span class="o">=</span><span class="n">profile_id</span><span class="p">,</span>
        <span class="n">calcrule_id</span><span class="o">=</span><span class="n">CALCRULE_ID_OCCURRENCE_LIMIT_AND_SHARE</span><span class="p">,</span>
        <span class="n">deductible1</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>      <span class="c1"># Not used</span>
        <span class="n">deductible2</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>      <span class="c1"># Not used</span>
        <span class="n">deductible3</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>      <span class="c1"># Not used</span>
        <span class="n">attachment</span><span class="o">=</span><span class="n">attachment</span><span class="p">,</span>
        <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span>
        <span class="n">share1</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>           <span class="c1"># Not used</span>
        <span class="n">share2</span><span class="o">=</span><span class="n">placement</span><span class="p">,</span>   <span class="c1"># Not used</span>
        <span class="n">share3</span><span class="o">=</span><span class="mf">1.0</span>          <span class="c1"># Not used</span>
    <span class="p">)</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Oasis LMF

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>